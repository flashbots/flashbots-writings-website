<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Flashbots Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Flashbots Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Understanding liveness risks from mev-boost | Flashbots</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://writings.flashbots.net/understanding-mev-boost-liveness-risks"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Understanding liveness risks from mev-boost | Flashbots"><meta data-react-helmet="true" name="description" content="Over the last few days, mev-boost has been a hot discussion topic in the community. We want to take this opportunity to highlight and educate the design and trust assumptions that make mev-boost possible as a merge-ready PBS solution."><meta data-react-helmet="true" property="og:description" content="Over the last few days, mev-boost has been a hot discussion topic in the community. We want to take this opportunity to highlight and educate the design and trust assumptions that make mev-boost possible as a merge-ready PBS solution."><meta data-react-helmet="true" property="og:image" content="https://writings.flashbots.net/img/og_forest.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://writings.flashbots.net/img/og_forest.jpg"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-08-05T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://twitter.com/hasufl"><meta data-react-helmet="true" property="article:tag" content="mev-boost"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://writings.flashbots.net/understanding-mev-boost-liveness-risks"><link data-react-helmet="true" rel="alternate" href="https://writings.flashbots.net/understanding-mev-boost-liveness-risks" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://writings.flashbots.net/understanding-mev-boost-liveness-risks" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.1b11a3d0.css">
<link rel="preload" href="/assets/js/runtime~main.84cea9a3.js" as="script">
<link rel="preload" href="/assets/js/main.ddcd350a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navRoot_1Vd8 navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items fixFlex_19nV"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><svg width="12" height="14" viewBox="0 0 12 14"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.07289 0L7.91879 0.483459L6.631 4.76674H11.5178L4.19989 12.679L3.35398 12.1956L4.72089 7.64736H0L7.07289 0ZM5.20514 6.03608L6.33835 2.26697L2.28701 6.64736H5.02136L5.20514 6.03608ZM4.93407 10.4124L9.23077 5.76674H6.33078L6.16271 6.3243L4.93407 10.4124Z" fill="var(--ifm-font-color-base)"></path></svg><span class="navbar__title title_2fsg logoTitle_2plQ">Flashbots</span></a></div><div class="navbar__items navbar__items--right fixFlex_19nV navItems_l2fJ"><a href="https://flashbots.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>About</span></a><a href="https://boost.flashbots.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>MEV-Boost</span></a><a href="https://collective.flashbots.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Forum</span></a><a href="https://jobs.flashbots.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Join us</span></a><div class="react-toggle toggle_268h react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page layoutDefaults_1s0t"><div class="container margin-vert--md containerRoot_3RmU"><div class="row"><main class="col col--12" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_nmLu" itemprop="headline">Understanding liveness risks from mev-boost</h1><div class="blogPostData_3WzT margin-vert--md"><time datetime="2022-08-05T00:00:00.000Z" itemprop="datePublished">05.08.22</time> ¬∑ 9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_HqTB"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/hasufl" target="_blank" rel="noopener noreferrer" class="fixedColor_3yYP" itemprop="url"><span itemprop="name">Hasu</span></a></div></div></div></div></div></header><meta itemprop="image" content="https://writings.flashbots.net/img/og_forest.jpg"><div class="markdown" itemprop="articleBody"><p>Over the last few days, mev-boost has been a hot discussion topic in the community. We want to take this opportunity to highlight and educate the design and trust assumptions that make mev-boost possible as a merge-ready PBS solution.</p><p>First, it‚Äôs important to note that the reports of new issues or trust assumptions being discovered are false. Everything discussed in this post has been known properties of mev-boost and discussed in the initial <a href="https://ethresear.ch/t/mev-boost-merge-ready-flashbots-architecture/11177" target="_blank" rel="noopener noreferrer">mev-boost research post</a>. Each issue has a known and accepted mitigation which is being implemented in consensus clients. The merge and mev-boost are both on track for launch at the scheduled timeline. You can keep an eye on the readiness of each consensus client and node operator on the mev-boost landing page over at <a href="http://boost.flashbots.net" target="_blank" rel="noopener noreferrer">boost.flashbots.net</a></p><p>With this said, let&#x27;s take a deep look at the mev-boost design, trust assumptions and why they were chosen, and how we mitigate liveness risks to Ethereum.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="block-withholding-attacks"></a>Block withholding attacks<a class="hash-link" href="#block-withholding-attacks" title="Direct link to heading">#</a></h2><p>To bring you up to speed, mev-boost is middleware that validators can run to outsource their block construction to a market of block builders. In the middle of builders and validators sit ‚Äúrelays‚Äù, which are in charge of facilitating smooth commerce between the two parties. The relay protects the builder from leaking any information about the block to the validators and ensures that even small validators can participate in the builder market. At the same time, the relay protects the validator from receiving blocks that are invalid, overstate their bid to the validator, or are missing entirely. (More on this later in ‚Äú<em>Why was this design chosen?</em>‚Äù)</p><p>Relays can connect to one or many builders, and we expect that there will be both variants. A relay connecting to many builders will aggregate their bids (fun fact: in a previous iteration, we called them builder aggregators or builder pools). The relay can see all the blocks submitted by the builders to confirm their validity and how much they pay to the validator. The relay then only submits the highest valid bid to the validator to sign.</p><p>Before validators can receive any bids from relays, they need to <a href="https://boost.flashbots.net/" target="_blank" rel="noopener noreferrer">set up mev-boost</a> and add relays to their mev-boost config. mev-boost is effectively just a relay aggregator or a local relay of relays. It will serve the validator the winning bid from all relays. A validator can connect to a small number of relays that aggregate all the builders, and many will probably do that. Other validators might connect to many relays.</p><p>If mev-boost has no relays in the config OR all relays are offline, then the beacon node (BN) will always fall back to constructing a block from the public mempool. So we know the risk is not all relays going offline. So what is the risk? It is that:</p><ul><li>The entire network connects to the same relay (not necessarily exclusively), AND</li><li>That relay is the highest bidding relay, so its block is selected by validators, AND</li><li>The relay sends the block header for signing (= it is not offline) but after receiving the validator signature, does not publish the final block to the network.</li></ul><p>In this case, the same relay would keep suggesting blocks to validators, and these validators would keep signing them, and then no block would be published. The result is a series of empty slots. The network not making blocks is typically called a <em>liveness issue</em>. (It is different from a DDOS attack because the affected nodes still fulfill all of their other network duties like publishing attestations, gossiping messages, etc.)</p><p>This fault can happen via a bug or a malicious relay. In the bug case, we expect the relay to realize their problem and fix it quickly or go offline entirely. So the more relevant case to protect against is a malicious relay launching a deliberate <em>withholding attack</em>.</p><p>It is important to emphasize that a <em>withholding attack</em> can immediately cascade into a <em>liveness issue</em> for the entire network. That is because a malicious relay can lie about its bid to guarantee it is always selected by all validators that register with it. For example, imagine a malicious relay bidding an artificially high number that is higher than that of honest relays.</p><p>This attack is free for the relay because it never publishes the block and pays the validator, and yet all affected validators miss their slot for proposing.</p><p>Importantly, we are not concerned about 10% of the network connecting to a faulty relay, but only when a faulty relay is so popular that it creates systemic risk for the network. To recycle a famous saying, if 10% of validators miss their slot, it is their problem. If 100% of validators miss their slot, it is Ethereum‚Äôs problem.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="mapping-the-solution-space"></a>Mapping the solution space<a class="hash-link" href="#mapping-the-solution-space" title="Direct link to heading">#</a></h2><p>So, let‚Äôs say a popular relay is withholding blocks; how does the system recover? From first principles, the system recovers when <em>any</em> of the below steps happen:</p><ol><li>Validators remove the faulty relay from their mev-boost config (or turn off mev-boost entirely), OR</li><li>Other relays start outbidding the faulty relay, OR</li><li>The faulty relay goes offline entirely, OR</li><li>The faulty relay starts publishing blocks again</li></ol><p>Looking at the ‚Äúdefenses‚Äù against the faulty relay, it becomes clear that cases 3-4 are within the control of the faulty relay, and case 2 is in the control of the other relays. But as validators, we are only interested in solutions that let us remove relays once we realize they are faulty.</p><p>In this solution space, there are two categories: <em>local</em> and <em>global solutions</em>. The local solutions are the most simple ‚Äî the validator (or their mev-boost) can track the most recent performance of a relay. If a relay misrepresented payments or didn‚Äôt publish blocks, the validator can automatically remove it. But this solution has a problem of <em>local information.</em> The solution protects a single validator from a bad relay, but the next validator doesn‚Äôt know about the bad relay. A local solution may be enough for Coinbase, Lido, Binance, Kraken, etc., because they control so many validators that their ‚Äúlocal‚Äù is a good approximation for the network‚Äôs ‚Äúglobal‚Äù anyway ‚Äî but it doesn‚Äôt help smaller validators. These validators need to know how the relays performed <em>on the slots of previous other validators</em>.</p><p>It seems that we need a <em>global solution.</em> In a global solution, validators look at the global history of the network, not just their own, to remove relays. The community is building two global solutions ahead of the merge.</p><p>The first is a <a href="https://github.com/flashbots/mev-boost/issues/142" target="_blank" rel="noopener noreferrer">relay monitor</a> operated by a trusted third party. This monitor watches the global performance of relays and can send a message a la ‚Äúremove relay x now‚Äù to validators. So if any relay misbehaves, all validators who connect to the relay monitor will have their configs updated. Are there any new risks with this approach? We recall from earlier that an empty mev-boost config means that validators fall back to local block production. So the relay monitor can only temporarily remove relays from a validator‚Äôs config, not add any new ones, or cause the validator to miss any slots.</p><p>The second solution, introduced in the call by <a href="https://twitter.com/ralexstokes" target="_blank" rel="noopener noreferrer">Alex Stokes</a>, is the <a href="https://hackmd.io/@ralexstokes/BJn9N6Thc" target="_blank" rel="noopener noreferrer">circuit breaker</a>. It works similarly to a relay monitor but does not rely on a third-party service. The circuit breaker is part of the beacon node. It looks at the local view of the network, and if the node sees x out of y missed slots in a row, it will disconnect from the builder network and fall back to producing blocks locally. There is some nuance about picking a good number for x because a small number would allow a large validator to miss slots on purpose to trigger the circuit breaker for the rest of the network and turn off their mev-boost. A large number could lead to many missed slots in a row.</p><p>The above and further, less-mature solutions are being discussed in this <a href="https://github.com/flashbots/mev-boost/issues/222" target="_blank" rel="noopener noreferrer">GitHub issue</a>. Eventually, Enshrined PBS will do away with relays entirely, but this is still a few years away.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="why-was-this-design-chosen"></a>Why was this design chosen?<a class="hash-link" href="#why-was-this-design-chosen" title="Direct link to heading">#</a></h2><p>Due to the commit-reveal scheme used in mev-boost, relays can fail to release blocks after making the winning bid. This attack vector has been known from the start and it is a calculated choice. Why did we choose it?</p><p>The alternative would have been to continue with Flashbots‚Äô pre-PoS design that we call ‚Äú<a href="https://writings.flashbots.net/why-run-mevboost" target="_blank" rel="noopener noreferrer">Stage 1 PBS</a>‚Äù. In Stage 1 PBS, block builders send full blocks to validators in cleartext, and validators have to open a DOS-sensitive RPC to block builders.</p><p>The advantage of the Stage 1 design has been that validators can always look at the block to verify that the block is valid and how much it pays the validator. If no builder sends a block in time, the validator can fall back to local block construction and there is no risk of ever missing a slot.</p><p>But the disadvantage is that block builders need to trust validators not to steal MEV from them, and validators need to trust block builders not to DoS attack them. The unfortunate consequence is that only trusted validators and builders can participate in the PBS market.</p><p>So, while the old design has nice properties against block withholding attacks, it would have completely cut off solo stakers from MEV extraction. After public discussions with the Ethereum community and other key stakeholders, this cost was deemed too high and we settled in favor of a design that can include them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>I hope this post helps you frame the trust assumptions of mev-boost, why they were chosen, and what mitigations will be in place to avoid liveness risk to Ethereum. The relay monitor will be ready for the merge. The circuit breakers are being developed and some consensus clients already have them implemented. Together with validators practicing good relay hygiene (only using trusted relays until further mitigations are in place, setting up downtime monitors for their slots), I think we are in a good position for the merge.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="references"></a>References<a class="hash-link" href="#references" title="Direct link to heading">#</a></h2><ul><li><a href="https://ethresear.ch/t/mev-boost-merge-ready-flashbots-architecture/11177" target="_blank" rel="noopener noreferrer">mev-boost architecture</a></li><li><a href="https://boost.flashbots.net/" target="_blank" rel="noopener noreferrer">mev-boost homepage</a></li><li><a href="https://writings.flashbots.net/why-run-mevboost/" target="_blank" rel="noopener noreferrer">Why run mev-boost?</a></li><li><a href="https://github.com/flashbots/mev-boost/issues/222" target="_blank" rel="noopener noreferrer">liveness mitigations GitHub issue</a></li><li><a href="https://github.com/flashbots/mev-boost/issues/142" target="_blank" rel="noopener noreferrer">relay monitor</a></li><li><a href="https://hackmd.io/@ralexstokes/BJn9N6Thc" target="_blank" rel="noopener noreferrer">circuit breaker proposal</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Flashbots-Relay-open-sourcing"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">¬´ Open sourcing the Flashbots Relay</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mev-boost-call-for-testing"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Boost your MEV in Ethereum proof-of-stake ¬ª</div></a></div></nav></main><div class="col col--2 TOC_1KIS"><div class="tableOfContents_rbnR thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#block-withholding-attacks" class="table-of-contents__link">Block withholding attacks</a></li><li><a href="#mapping-the-solution-space" class="table-of-contents__link">Mapping the solution space</a></li><li><a href="#why-was-this-design-chosen" class="table-of-contents__link">Why was this design chosen?</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#references" class="table-of-contents__link">References</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="col footer__links"><div><ul class="row footer__items"><li class="footer__item"><a href="https://github.com/flashbots" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://docs.flashbots.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation</a></li><li class="footer__item"><a href="https://status.flashbots.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status</a></li></ul></div><div><ul class="row footer__items"><li class="footer__item"><a href="https://calendar.flashbots.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Calendar</a></li><li class="footer__item"><a href="https://writings.flashbots.net/tags/transparency-report" target="_blank" rel="noopener noreferrer" class="footer__link-item">Transparency reports</a></li></ul></div><div><ul class="row footer__items"><li class="footer__item"><a href="http://discord.gg/flashbots" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCclbTgsnYUy3vmrptIqCmqQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2022 Flashbots, Ltd</div></div></div></footer></div>
<script src="/assets/js/runtime~main.84cea9a3.js"></script>
<script src="/assets/js/main.ddcd350a.js"></script>
</body>
</html>