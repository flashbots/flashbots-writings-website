"use strict";(self.webpackChunkwrittings_website=self.webpackChunkwrittings_website||[]).push([[6350],{3905:function(e,t,o){o.d(t,{Zo:function(){return h},kt:function(){return p}});var r=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,r,a=function(e,t){if(null==e)return{};var o,r,a={},n=Object.keys(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},h=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var o=e.components,a=e.mdxType,n=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),d=c(o),p=a,m=d["".concat(l,".").concat(p)]||d[p]||u[p]||n;return o?r.createElement(m,i(i({ref:t},h),{},{components:o})):r.createElement(m,i({ref:t},h))}));function p(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=o.length,i=new Array(n);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<n;c++)i[c]=o[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,o)}d.displayName="MDXCreateElement"},2572:function(e,t,o){o.r(t),o.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},assets:function(){return h},toc:function(){return u},default:function(){return p}});var r=o(7462),a=o(3366),n=(o(7294),o(3905)),i=["components"],s={slug:"searching-post-merge",title:"Searching Post-Merge",authors:["brock"],tags:["pos"],hide_table_of_contents:!1},l="Searching Post-Merge",c={permalink:"/writings/searching-post-merge",source:"@site/writings/2022-08-25-searching-post-merge.mdx",title:"Searching Post-Merge",description:"If you're a searcher on Proof of Work (PoW) Ethereum and you're wondering how your experience will change as Ethereum switches to Proof of Stake (PoS), then this post is for you.",date:"2022-08-25T00:00:00.000Z",formattedDate:"August 25, 2022",tags:[{label:"pos",permalink:"/writings/tags/pos"}],readingTime:9.175,truncated:!0,authors:[{name:"Brock Smedley",title:"Searcher Experience @ Flashbots",url:"https://twitter.com/zeroXbrock",imageURL:"https://pbs.twimg.com/profile_images/1254945021159071745/drzbani3_400x400.jpg",key:"brock"}],prevItem:{title:"order flow, auctions and centralisation I - a warning",permalink:"/writings/order-flow-auctions-and-centralisation"},nextItem:{title:"Flashbots Protect -- The Merge & Beyond",permalink:"/writings/flashbots-protect-merge-and-beyond"}},h={authorsImageUrls:[void 0]},u=[{value:"Key Takeaways",id:"key-takeaways",children:[]},{value:"Proposer/Builder Separation (PBS)",id:"proposerbuilder-separation-pbs",children:[]},{value:"Bidding for Inclusion",id:"bidding-for-inclusion",children:[]},{value:"How to Choose a Good Builder",id:"how-to-choose-a-good-builder",children:[]},{value:"What Stays the Same",id:"what-stays-the-same",children:[]},{value:"What Changes for Searchers",id:"what-changes-for-searchers",children:[{value:"Blockbuilding Algorithm",id:"blockbuilding-algorithm",children:[]},{value:"MEV-Blocks API",id:"mev-blocks-api",children:[]},{value:"Better Support",id:"better-support",children:[]}]},{value:"Conclusion",id:"conclusion",children:[]}],d={toc:u};function p(e){var t=e.components,s=(0,a.Z)(e,i);return(0,n.kt)("wrapper",(0,r.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"If you're a searcher on Proof of Work (PoW) Ethereum and you're wondering how your experience will change as Ethereum switches to Proof of Stake (PoS), then this post is for you."),(0,n.kt)("p",null,"In this document I'll explain new concepts like what proposer/builder separation (PBS), block building, and PoS validators are in simple terms. Moreover, I'll outline how these terms relate to searching and PoW Ethereum. Finally, I'll also address common questions related to this these topics."),(0,n.kt)("p",null,"This post was written as a labor of love for the searcher community. We at Flashbots are working hard so that you can be merge-ready and start searching PoS Ethereum on day one!"),(0,n.kt)("hr",null),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#key-takeaways"},"Key Takeaways")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#proposerbuilder-separation-pbs"},"Proposer/Builder Separation (PBS)")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#bidding-for-inclusion"},"Bidding for Inclusion")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#how-to-choose-a-good-builder"},"How to Choose a Good Builder")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#what-stays-the-same"},"What Stays the Same")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#what-changes-for-searchers"},"What Changes for Searchers"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#blockbuilding-algorithm"},"Blockbuilding Algorithm")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#mev-blocks-api"},"MEV-Blocks API")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#better-support"},"Better Support")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#conclusion"},"Conclusion"))),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"key-takeaways"},"Key Takeaways"),(0,n.kt)("p",null,"After the merge,"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("strong",{parentName:"li"},"mev-boost")," separates what PoS validators (PoW miners) do into two roles: block building and block proposal. Searchers will send bundles to block builders, or they may be block builders themselves."),(0,n.kt)("li",{parentName:"ol"},"With mev-boost, searchers will need to reason about two auctions. First, searchers compete for bundle inclusion within blocks that builders are proposing. Second, builders compete for block inclusion. To be included on-chain a searcher's bundle must win the blockspace auction for the builder they submit to, ",(0,n.kt)("em",{parentName:"li"},"and")," the builder they submit to must win the auction amongst different builders."),(0,n.kt)("li",{parentName:"ol"},"Choosing a builder that is performant and can be trusted with your transactions is critical."),(0,n.kt)("li",{parentName:"ol"},"Existing client libraries for Flashbots are already compatible with post-merge architecture \u2014 ",(0,n.kt)("strong",{parentName:"li"},"no changes are needed from searchers to send bundles to Flashbots"),"."),(0,n.kt)("li",{parentName:"ol"},"The Flashbots builder will use a new algorithm to produce the most profitable block. We no longer guarantee top-of-block execution and ordering with respect to effective gas prices for bundles. Rather, the algorithm optimizes for overall profit. Bundles are still included in the block atomically, but non-bundle transactions may now be included between bundles."),(0,n.kt)("li",{parentName:"ol"},"We rolled out ",(0,n.kt)("a",{parentName:"li",href:"mailto:searchersupport@flashbots.net"},"searchersupport@flashbots.net")," and the ",(0,n.kt)("a",{parentName:"li",href:"https://collective.flashbots.net/c/searchers/12"},"Searcher Self-Support Group")," forum to improve searcher support.")),(0,n.kt)("h2",{id:"proposerbuilder-separation-pbs"},"Proposer/Builder Separation (PBS)"),(0,n.kt)("p",null,"PBS splits the responsibilities of PoW miners (PoS validators) into two roles: block building and block proposal. Block builders are specialists who accept transactions from users and searchers, and try to build the most profitable block possible from those transactions. mev-boost is a trusted form of PBS implemented post-merge where builders submit blocks to a trusted entity (or entities) called relays. Relays are responsible for aggregating blocks from builders and figuring out which block is the most profitable, which is ultimately what validators sign and what is included on-chain. You can read more about relays in ",(0,n.kt)("a",{parentName:"p",href:"https://collective.flashbots.net/t/how-are-relays-defined-in-pos-ethereum/148?u=brock"},"this forum post"),"."),(0,n.kt)("p",null,"As a searcher on PoS Ethereum, your primary concern regarding PBS is sending your transactions/bundles to the right builder(s). Builders, and the relays they connect to, will be able to see your transactions before they're included (which means they can front-run, censor, etc), so it's important to choose builders that you trust."),(0,n.kt)("p",null,"While it doesn't directly impact searchers, it should also be noted that ",(0,n.kt)("strong",{parentName:"p"},"mev-boost")," is the component that enables validators to plug into the PBS builder network. In short, it chooses the most profitable block from multiple relays. If you want to learn more about this, check out the ",(0,n.kt)("a",{parentName:"p",href:"https://boost.flashbots.net/"},"official mev-boost website"),". It's also worth noting that this implementation of PBS is only a stopgap for in-protocol PBS. Eventually, PBS will be built into Ethereum natively, which will eliminate the need for trusted relays."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"mevboost-searcher-bundle-flow.png",src:o(2165).Z})),(0,n.kt)("h2",{id:"bidding-for-inclusion"},"Bidding for Inclusion"),(0,n.kt)("p",null,"In PoW Ethereum there is only one auction for inclusion: the blockspace auction. Searchers simply have to bid more than the other searchers vying for the same MEV opportunity, and as long as their transactions don't get censored by the miner, and are profitable enough to the miner, they will be included."),(0,n.kt)("p",null,"mev-boost adds a new auction to the mix: the ",(0,n.kt)("strong",{parentName:"p"},"slot auction"),". Validators using mev-boost fetch the most profitable block from the relays they connect to, which means that block builders effectively bid for inclusion with the value of the block they produce. When PBS is implemented in-protocol, there will no longer be relays, so validators will pick the most profitable block directly from builders. Check out ",(0,n.kt)("a",{parentName:"p",href:"https://collective.flashbots.net/t/how-are-relays-defined-in-pos-ethereum/148?u=brock"},"this forum post")," for more information about relays."),(0,n.kt)("p",null,"In essence, the ",(0,n.kt)("a",{parentName:"p",href:"https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/#validators"},"slot")," auction is a game of which builder can create the most profitable block for the validator. Builders may choose to rely only on transaction fees and MEV to constitute the value of their block, but they also have the option to send additional funds to the validator directly for a better chance of inclusion."),(0,n.kt)("p",null,"You may consider bidding for the slot auction ",(0,n.kt)("em",{parentName:"p"},"in addition")," to the blockspace auction to increase the chance that your builder's block gets included on-chain. This can be done by sending ETH directly to the address of the validator responsible for filling the target slot."),(0,n.kt)("p",null,"Although sending bundles to a builder with less searcher competition will reduce your chance of being outbid in the blockspace auction, choosing a good builder that accepts transactions from other searchers will generally improve your chances of inclusion. The more a block is worth (transaction fees + MEV), the more likely it is to win the slot auction and be included on-chain."),(0,n.kt)("p",null,"You may also consider sending your bundles to multiple builders as part of your strategy. Even if you have the most profitable ",(0,n.kt)("em",{parentName:"p"},"bundle")," in a block, that ",(0,n.kt)("em",{parentName:"p"},"block")," could still lose the slot auction. If you have the most profitable bundle in several builders' blocks, your odds improve. That being said, different builders will have different sources of incoming transactions and bundles, and thus different potential conflicts with your bundle. Bid accordingly."),(0,n.kt)("h2",{id:"how-to-choose-a-good-builder"},"How to Choose a Good Builder"),(0,n.kt)("p",null,"There are a few criteria to look for in a block builder:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Are they committed to fair and unbiased execution?",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"A good builder will not front-run, sandwich or censor bundles, or otherwise engage in activities that abuse privileged data access."))),(0,n.kt)("li",{parentName:"ul"},"Do they connect to a trusted relay (or relays)?",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Keep in mind that the relay can also see raw transactions, which gives them the ability to front-run, censor, etc."))),(0,n.kt)("li",{parentName:"ul"},"Do their relays connect to enough validators?",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"The more validators a relay connects to, the more slots will generally be available for builders connected to that relay. When you're targeting a specific block/slot, it's imperative that you send your transactions to a builder which is connected to the validator responsible for proposing a block in that slot. More validators \u21d2 better inclusion rates."),(0,n.kt)("li",{parentName:"ul"},"Note: Any validator can ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/flashbots/mev-boost#usage"},"use mev-boost to connect to the Flashbots relay and other relays"),"."),(0,n.kt)("li",{parentName:"ul"},"It's also worth considering how much collective stake the validators connected to a relay have. Generally speaking, if more than one block is proposed to the network (unusual but possible), the block with the most collective stake attesting to it will be included. This scenario is explained in greater detail in the ",(0,n.kt)("a",{parentName:"li",href:"https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/#fork-choice"},"Ethereum docs"),".")))),(0,n.kt)("p",null,"Also note that block builders have the freedom to specialize. You may find that one builder is more or less friendly to your strategy than others. Builders are competing with each other, so they are all incentivized to include your bundles in their blocks, but you may find that some builders will prioritize certain strategies over others regardless of potential profits. Builders might also censor certain bundles due to local regulations or corporate strategies and policies. There are a lot of variables in play here, so I recommend trying a few trustworthy builders and seeing how your mileage varies first-hand."),(0,n.kt)("h2",{id:"what-stays-the-same"},"What Stays the Same"),(0,n.kt)("p",null,"Flashbots remains steadfast in our commitments to illuminate the dark forest, democratize MEV extraction, and distribute the benefits of MEV for social good, all while working in the open."),(0,n.kt)("p",null,"Flashbots will run a builder following the principles we've adhered to in PoW Ethereum: democratized access to MEV, fair & reliable execution, and privacy."),(0,n.kt)("p",null,"The Flashbots builder hosts all the same endpoints as the PoW mev-relay API. After the merge, the original URL for mev-relay (",(0,n.kt)("a",{parentName:"p",href:"http://relay.flashbots.net/"},"relay.flashbots.net"),") will point to the Flashbots builder, making the transition seamless \u2014 you won't have to change anything. Clients used to send, simulate, and debug bundles are already compatible with our post-merge architecture."),(0,n.kt)("h2",{id:"what-changes-for-searchers"},"What Changes for Searchers"),(0,n.kt)("h3",{id:"blockbuilding-algorithm"},"Blockbuilding Algorithm"),(0,n.kt)("p",null,"The Flashbots builder will use a new algorithm designed to produce the most profitable block possible. This design introduces some important changes for searchers to be aware of:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Instead of ranking and including bundles based off of effective gas price the algorithm now optimizes for overall block profit."),(0,n.kt)("li",{parentName:"ul"},"Top-of-block execution is no longer a guarantee."),(0,n.kt)("li",{parentName:"ul"},"Bundle ordering by effective gas price is no longer a guarantee."),(0,n.kt)("li",{parentName:"ul"},"Other transactions (e.g. from the mempool) may land between bundles (not between transactions in bundles, but between two different bundles).",(0,n.kt)("br",null),(0,n.kt)("em",{parentName:"li"},"For example:"),(0,n.kt)("br",null),"\nIf you have a bundle comprised of transactions ",(0,n.kt)("inlineCode",{parentName:"li"},"[B1, B2]"),(0,n.kt)("br",null),"\nand someone else has a bundle comprised of transactions ",(0,n.kt)("inlineCode",{parentName:"li"},"[C1, C2]"),(0,n.kt)("br",null),"\nand there are transactions in the mempool ",(0,n.kt)("inlineCode",{parentName:"li"},"[t1, t2, ...]"),",",(0,n.kt)("br",null),"\nthen the block may be built such that:",(0,n.kt)("br",null),(0,n.kt)("inlineCode",{parentName:"li"},"BLOCK_TXS = [..., B1, B2, t1, t2, C1, C2, ...]"),".",(0,n.kt)("br",null),"\nThe bundles still remain atomic, but the difference from the PoW architecture is that not all bundles will be ordered next to each other, and bundles are not necessarily placed at the top of the block.\n")),(0,n.kt)("h3",{id:"mev-blocks-api"},"MEV-Blocks API"),(0,n.kt)("p",null,"The data processed by the ",(0,n.kt)("a",{parentName:"p",href:"https://blocks.flashbots.net/"},"Blocks API")," will see some changes on the backend, but we will keep the existing API online through the merge by porting data from the Flashbots builder to the original API. This is done to maintain backwards compatibility with client libraries. We plan to expose a new ",(0,n.kt)("inlineCode",{parentName:"p"},"/v2")," API alongside the original, which will include information specific to PoS Ethereum \u2014 we'll release more details on this soon via ",(0,n.kt)("a",{parentName:"p",href:"https://twitter.com/zeroXbrock"},"Twitter")," and our ",(0,n.kt)("a",{parentName:"p",href:"https://discord.gg/fR3dNrQh"},"Discord server"),"."),(0,n.kt)("h3",{id:"better-support"},"Better Support"),(0,n.kt)("p",null,"First, we've created a new forum for searchers: The ",(0,n.kt)("a",{parentName:"p",href:"https://collective.flashbots.net/c/searchers/12"},"Searchers Self-Support Forum"),". This was created to facilitate long-form discussions about searching, and to help searchers find answers to common issues more quickly. We've also added new content in our ",(0,n.kt)("a",{parentName:"p",href:"https://docs.flashbots.net/flashbots-auction/searchers/faq"},"FAQ")," related to searching post-merge. Lastly, we've created a new email account for searchers to report problems, ask questions, and suggest new ideas: ",(0,n.kt)("a",{parentName:"p",href:"mailto:searchersupport@flashbots.net"},"searchersupport@flashbots.net")),(0,n.kt)("h2",{id:"conclusion"},"Conclusion"),(0,n.kt)("p",null,"In this post, we covered the basics of proposer/builder separation in PoS Ethereum, and how that affects searchers. We discussed the blockspace auction, which PoW searchers are already familiar with, and the new slot auction in which builders compete. We also explain some considerations for choosing builders, and how Flashbots will make the transition to searching on PoS Ethereum effortless."),(0,n.kt)("p",null,"Answers to common questions related to searching after the merge can be found in our ",(0,n.kt)("a",{parentName:"p",href:"https://docs.flashbots.net/flashbots-auction/searchers/faq"},"FAQ")," (latest questions at the end). We also invite you to join the discussion and share your questions and ideas in the ",(0,n.kt)("strong",{parentName:"p"},"new ",(0,n.kt)("a",{parentName:"strong",href:"https://collective.flashbots.net/c/searchers/12"},"Searchers Self-Support Forum")),"."))}p.isMDXComponent=!0},2165:function(e,t,o){t.Z=o.p+"assets/images/mevboost-searcher-bundle-flow-bae4ba67a9d8d928efe337f36defa14a.png"}}]);